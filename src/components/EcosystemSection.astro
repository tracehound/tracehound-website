---
import {
  Activity,
  ChevronRight,
  Database,
  Eye,
  Globe,
  Shield,
  Skull,
  Target,
  Zap,
} from 'lucide-react'
import { cn } from '../utils'

// Open-Core model: Substrate + Satellites + Advanced + Cockpit
const layers = [
  {
    name: 'Substrate',
    badge: 'FREE & OPEN SOURCE',
    badgeStyle: 'bg-primary/20 border-primary/30 text-primary',
    products: [
      {
        name: 'Tracehound Core',
        tagline: 'Security Buffer',
        description: 'Deterministic evidence, interception, quarantine, audit chain.',
        status: 'active',
        statusLabel: 'Available',
        color: '#8dde23',
        icon: Shield,
        href: '/docs/getting-started',
      },
    ],
  },
  {
    name: 'Satellites',
    badge: '$49/pkg/mo',
    badgeStyle: 'bg-purple-500/20 border-purple-500/30 text-purple-400',
    products: [
      {
        name: 'Argos',
        tagline: 'Behavioral Observer',
        description:
          'Runtime behavioral observation. Event loop starvation, anomalies, burst attacks.',
        status: 'development',
        statusLabel: 'In Development',
        color: '#a855f7',
        icon: Eye,
        href: '/argos',
      },
      {
        name: 'Talos',
        tagline: 'Policy Executor',
        description: 'External policy execution. Connect to OPA, custom engines for decisions.',
        status: 'coming',
        statusLabel: 'Q2 2026',
        color: '#f97316',
        icon: Target,
        href: '/talos',
      },
      {
        name: 'Huginn',
        tagline: 'Threat Intel',
        description: 'Threat intelligence ingestion. External feeds, MITRE mapping, IP reputation.',
        status: 'coming',
        statusLabel: 'Q2 2026',
        color: '#3b82f6',
        icon: Globe,
        href: '/huginn',
      },
      {
        name: 'Muninn',
        tagline: 'History Ledger',
        description: 'Historical ledger & aggregation. Time-series analysis, pattern storage.',
        status: 'coming',
        statusLabel: 'Q2 2026',
        color: '#10b981',
        icon: Database,
        href: '/muninn',
      },
    ],
  },
  {
    name: 'Advanced',
    badge: '$99/pkg/mo',
    badgeStyle: 'bg-orange-500/20 border-orange-500/30 text-orange-400',
    products: [
      {
        name: 'Norns',
        tagline: 'Readiness Synthesis',
        description: 'Deterministic pre-deployment security posture validation.',
        status: 'coming',
        statusLabel: 'Q3 2026',
        color: '#f59e0b',
        icon: Activity,
        href: '#',
      },
      {
        name: 'Furies',
        tagline: 'Adversarial Harness',
        description: 'Chaos engineering for security infrastructure. Stress testing.',
        status: 'coming',
        statusLabel: 'Q3 2026',
        color: '#ef4444',
        icon: Skull,
        href: '#',
      },
    ],
  },
  {
    name: 'Watchtower',
    badge: 'SUBSCRIPTION',
    badgeStyle: 'bg-blue-500/20 border-blue-500/30 text-blue-400',
    products: [
      {
        name: 'Watchtower',
        tagline: 'Forensic Cockpit',
        description: 'Visualization, workflow acceleration. Makes humans effective.',
        status: 'coming',
        statusLabel: 'Q4 2026',
        color: '#0ea5e9',
        icon: Zap,
        href: '#',
      },
    ],
  },
]

const statusStyles: Record<string, string> = {
  active: 'bg-green-500/10 border-green-500/30 text-green-400',
  development: 'bg-yellow-500/10 border-yellow-500/30 text-yellow-400',
  coming: 'bg-white/5 border-white/10 text-text-muted',
}
---

<section id="ecosystem" class="py-24 border-t border-surface-highlight">
  <div class="container-custom">
    <div class="text-center mb-16">
      <span class="text-xs font-mono text-primary tracking-wider uppercase">The Ecosystem</span>
      <h2 class="text-3xl md:text-4xl font-bold mt-2 mb-4">
        Open-Core<br />
        <span class="text-text-muted">Security Platform.</span>
      </h2>
      <p class="text-text-muted max-w-2xl mx-auto">
        Core substrate is free and open source. Satellites extend capability, not safety. Payment
        affects what you can add, not what you can see.
      </p>
    </div>

    <!-- Layers -->
    <div class="space-y-12 max-w-6xl mx-auto">
      {
        layers.map((layer) => (
          <div>
            <div class="flex items-center gap-4 mb-4">
              <h3 class="text-lg font-bold text-white font-mono">{layer.name}</h3>
              <span class={`text-xs px-3 py-1 rounded-full border ${layer.badgeStyle}`}>
                {layer.badge}
              </span>
            </div>

            <div
              class={`grid gap-4 ${layer.products.length === 1 ? 'md:grid-cols-1 max-w-md' : layer.products.length === 2 ? 'md:grid-cols-2' : 'md:grid-cols-2 lg:grid-cols-4'}`}>
              {layer.products.map((product) => {
                const Icon = product.icon
                const isDisabled = product.status === 'coming' && product.href === '#'
                return (
                  <a
                    href={product.href}
                    class={cn(
                      'group p-5 bg-surface/30 border border-surface-highlight/50 rounded-lg hover:border-surface-highlight transition-all',
                      {
                        'opacity-60 pointer-events-none': isDisabled,
                      },
                    )}
                    style={`--product-color: ${product.color}`}>
                    <div class="flex items-start justify-between mb-3">
                      <div
                        class="w-10 h-10 rounded-lg border flex items-center justify-center shrink-0"
                        style={`background: ${product.color}15; border-color: ${product.color}30; color: ${product.color}`}>
                        <Icon className="w-5 h-5" />
                      </div>
                      <span
                        class={`text-xs px-2 py-1 rounded-full border ${statusStyles[product.status]}`}>
                        {product.statusLabel}
                      </span>
                    </div>

                    <div class="mb-2">
                      <h4
                        class="font-semibold text-base group-hover:text-white transition-colors"
                        style={`color: ${product.color}`}>
                        {product.name}
                      </h4>
                      <span class="text-xs text-text-muted">{product.tagline}</span>
                    </div>

                    <p class="text-sm text-text-muted mb-3 line-clamp-2">{product.description}</p>

                    {!isDisabled && (
                      <div class="flex items-center text-xs text-text-muted group-hover:text-white transition-colors">
                        <span>Learn more</span>
                        <ChevronRight className="w-4 h-4 ml-1 group-hover:translate-x-0.5 transition-transform" />
                      </div>
                    )}
                  </a>
                )
              })}
            </div>
          </div>
        ))
      }
    </div>

    <!-- CTA -->
    <div class="text-center mt-12">
      <a
        href="/pricing"
        class="inline-flex items-center gap-2 px-6 py-3 bg-primary/10 border border-primary/30 text-primary hover:bg-primary/20 hover:border-primary/50 rounded-sm font-medium transition-all"
      >
        View Pricing & Licensing
        <ChevronRight className="w-4 h-4" />
      </a>
    </div>
  </div>
</section>
