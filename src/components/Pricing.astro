---
import { ArrowRight, Check, Shield, X, Zap } from 'lucide-react'

// New pricing model: Capacity-based, Security Invariants preserved at all tiers
const { showArgos = false } = Astro.props

const tiers = [
  {
    name: 'Starter',
    subtitle: 'Same Security, Small Scale',
    price: '$9',
    period: '/ month per service',
    features: [
      { text: 'Full Security Model (Agent, Quarantine, AuditChain)', included: true },
      { text: 'HoundPool Isolation (1 process, 64MB)', included: true },
      { text: 'Rate Limiter (token bucket)', included: true },
      { text: 'In-memory state only', included: true },
      { text: 'Cold Storage', included: false },
      { text: 'Notification API', included: false },
      { text: 'Scheduler', included: false },
    ],
    who: 'Solo Developers, Small Projects',
    cta: 'Get Started',
    ctaLink: '/checkout/starter',
    highlight: false,
    borderColor: 'border-surface-highlight',
  },
  {
    name: 'Pro',
    subtitle: 'Scaled Operations',
    price: '$99',
    period: '/ month per service',
    features: [
      { text: 'Full Security Model (all Starter features)', included: true },
      { text: 'HoundPool Scaling (8 processes, 512MB)', included: true },
      { text: 'Notification API (SIEM, SOC, webhooks)', included: true },
      { text: 'Async Codec (streaming compression)', included: true },
      { text: 'Evidence Export (S3, R2, GCS)', included: true },
      { text: 'Retention & Eviction Policies', included: true },
      { text: 'Email Support (24h SLA)', included: true },
    ],
    who: 'Growing SaaS, Bootstrapped Startups',
    cta: 'Choose this plan',
    ctaLink: '/checkout/pro',
    highlight: true,
    borderColor: 'border-primary',
  },
  {
    name: 'Enterprise',
    subtitle: 'Unlimited + SLA',
    price: '$499+',
    period: '/ month',
    features: [
      { text: 'Full Security Model (all Pro features)', included: true },
      { text: 'HoundPool Unlimited Scaling', included: true },
      { text: 'Multi-Instance (Redis coordination)', included: true },
      { text: 'SIEM Integration (Splunk, Elastic, Datadog)', included: true },
      { text: 'Compliance Reports (SOC2, HIPAA)', included: true },
      { text: 'Priority Support / Slack', included: true },
      { text: 'SLA Guarantee', included: true },
    ],
    who: 'Scale-up, Fintech, High-Traffic E-commerce',
    cta: 'Contact us',
    ctaLink: '/checkout/enterprise',
    borderColor: 'border-surface-highlight',
  },
]
---

<section class="py-24" id="pricing">
  <div class="container-custom">
    <div class="text-center max-w-2xl mx-auto mb-16">
      <h2 class="text-3xl md:text-5xl font-bold mb-6 tracking-tight">
        Simple <span class="text-primary">per-service</span> pricing.
      </h2>
      <p class="text-text-muted text-lg">
        No request counting. No surprise bills. One price per logical service.
      </p>
    </div>

    <div class="grid lg:grid-cols-3 gap-8">
      {
        tiers.map((tier) => (
          <div
            class={`relative flex flex-col bg-surface/50 border ${tier.borderColor} ${tier.highlight ? 'border-primary ring-1 ring-primary/20' : ''} ${tier.highlight ? 'border-dashed' : 'border-dotted'} p-8 hover:bg-surface/80 transition-colors rounded-sm`}>
            {tier.highlight && (
              <div class="absolute -top-3 left-1/2 -translate-x-1/2 bg-primary text-background px-3 py-0.5 text-xs font-bold uppercase tracking-wider rounded-sm flex items-center gap-1">
                <Zap className="h-3 w-3" /> For Growing SaaS
              </div>
            )}

            <div class="mb-8">
              <h3 class="text-xl font-bold text-white mb-1 font-mono">{tier.name}</h3>
              <p class="text-sm text-text-muted mb-6 font-mono">{tier.subtitle}</p>
              <div class="flex items-baseline gap-1">
                <span class="text-4xl font-bold text-white tracking-tight">{tier.price}</span>
                {tier.period && (
                  <span class="text-sm text-text-muted font-mono">{tier.period}</span>
                )}
              </div>
            </div>

            <div class="space-y-4 flex-1">
              <ul class="space-y-3">
                {tier.features.map((feature) => (
                  <li
                    class={`text-sm flex items-start gap-3 ${feature.included ? 'text-text-muted' : 'text-text-muted/40'}`}>
                    {feature.included ? (
                      <Check className="h-4 w-4 text-primary shrink-0 mt-0.5" />
                    ) : (
                      <X className="h-4 w-4 text-text-muted/30 shrink-0 mt-0.5" />
                    )}
                    <span>{feature.text}</span>
                  </li>
                ))}
              </ul>

              <div class="pt-6 border-t border-white/5">
                <p class="text-xs text-text-muted">
                  Best for: <span class="text-white">{tier.who}</span>
                </p>
              </div>
            </div>

            <div class="mt-8 pt-4">
              <a
                href={tier.ctaLink}
                class={`block w-full py-3 px-4 text-center text-sm font-bold uppercase tracking-wider rounded-sm transition-all ${
                  tier.highlight
                    ? 'bg-primary text-background hover:bg-primary/90 shadow-[0_0_20px_rgba(242,201,76,0.2)]'
                    : 'bg-surface-highlight text-white hover:bg-surface-highlight/80 border border-white/5'
                }`}>
                {tier.cta}
              </a>
            </div>
          </div>
        ))
      }
    </div>

    <!-- Argos Section -->
    {
      showArgos && (
        <div class="mt-16 p-8 bg-purple-500/5 border border-dashed border-purple-500/30 rounded-sm hover:bg-purple-500/10 hover:border-solid transition-colors">
          <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-6">
            <div>
              <div class="inline-flex items-center gap-2 px-2 py-0.5 mb-3 text-xs font-mono text-purple-400 bg-purple-500/10 border border-purple-500/20 rounded-sm">
                SEPARATE PRODUCT
              </div>
              <h3 class="text-xl font-bold text-white mb-2 font-mono">Argos Runtime Observer</h3>
              <p class="text-text-muted text-sm max-w-lg">
                Event loop monitoring, runtime behavior analysis, anomaly detection.
                <br /> Works standalone or as Tracehound add-on.
              </p>
            </div>
            <div class="flex flex-col sm:flex-row gap-4 font-mono">
              <div class="px-4 py-3 bg-surface/50 border border-purple-500/20 rounded-sm text-center">
                <div class="text-purple-400 font-bold">$49/mo</div>
                <div class="text-text-muted text-xs">Standalone</div>
              </div>
              <div class="px-4 py-3 bg-surface/50 border border-purple-500/20 rounded-sm text-center">
                <div class="text-purple-400 font-bold">+$29/mo</div>
                <div class="text-text-muted text-xs">With Pro tier</div>
              </div>
              <a
                href="/checkout/argos"
                class="inline-flex items-center gap-2 px-6 py-3 bg-purple-600/20 hover:bg-purple-600/30 text-purple-300 border border-purple-500/50 rounded-sm font-medium transition-colors">
                Get started with Argos <ArrowRight className="w-4 h-4" />
              </a>
            </div>
          </div>
        </div>
      )
    }
  </div>
</section>
