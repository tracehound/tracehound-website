---
import { Check } from 'lucide-react'

// Open-Core Model: Substrate (OSS) + Paid Satellites
const { showSection = 'all' } = Astro.props

const layers = [
  {
    name: 'Substrate',
    access: 'Open Source',
    packages: [
      '@tracehound/core',
      '@tracehound/express',
      '@tracehound/fastify',
      '@tracehound/cli',
      '@tracehound/horizon',
    ],
    description: 'Deterministic evidence, interception, failure containment.',
    features: [
      'Agent.intercept() — Request interception',
      'Quarantine — Evidence buffer',
      'AuditChain — Merkle-chain integrity',
      'RateLimiter — Token bucket protection',
      'HoundPool — Process isolation (4 default, unlimited with Horizon)',
      'Scheduler — Jittered background tasks',
      'Notifications — Universal event subscription',
      'S3 Cold Storage — AWS S3, R2, GCS, MinIO (v1.1.0)',
      'Fail-Safe — Panic handling',
      'Horizon — $9 perpetual: Unlimited pools, multi-instance, mTLS',
    ],
    highlight: 'Core is free. Horizon ($9) extends for scale-out.',
    cta: 'Get Started',
    ctaLink: 'https://github.com/tracehound/core',
    border: 'border-primary',
    badge: 'FREE & OPEN SOURCE',
    badgeColor: 'bg-primary text-background',
  },
  {
    name: 'Satellites',
    access: '$49/mo per package',
    packages: [
      '@tracehound/argos',
      '@tracehound/talos',
      '@tracehound/huginn',
      '@tracehound/muninn',
    ],
    description: 'Enrichment, policy execution, threat intel, history ledger.',
    features: [
      'Argos — Runtime behavioral observation',
      'Talos — External policy execution',
      'Huginn — Threat intelligence ingestion',
      'Muninn — Historical ledger & aggregation',
    ],
    highlight: 'Extend capability without touching core security paths.',
    cta: 'Choose this plan',
    ctaLink: '/checkout/satellites',
    border: 'border-purple-500',
    badge: 'PAID',
    badgeColor: 'bg-purple-500 text-purple-100',
  },
  {
    name: 'Advanced',
    access: '$99/mo per package',
    packages: ['@tracehound/norns', '@tracehound/furies'],
    description: 'Readiness synthesis, adversarial stress harness.',
    features: [
      'Norns — Deterministic readiness synthesis',
      'Furies — Adversarial validation & stress testing',
    ],
    highlight: 'Enterprise-grade validation and chaos engineering.',
    cta: 'Contact us',
    ctaLink: '/checkout/advanced',
    border: 'border-orange-500',
    badge: 'ENTERPRISE',
    badgeColor: 'bg-orange-500 text-orange-100',
  },
  {
    name: 'Watchtower',
    access: 'Subscription',
    packages: ['@tracehound/watchtower'],
    description: 'Forensic visualization and workflow acceleration.',
    features: ['Forensic cockpit', 'Operational dashboard', 'Workflow accelerator'],
    highlight: 'Makes humans effective. Does not create evidence or make decisions.',
    cta: 'Coming Soon',
    ctaLink: '#',
    border: 'border-blue-500',
    badge: 'COMING SOON',
    badgeColor: 'bg-blue-500 text-blue-100',
  },
]
---

<section class="py-24" id="pricing">
  <div class="container-custom">
    <div class="text-center max-w-3xl mx-auto mb-16">
      <h2 class="text-3xl md:text-5xl font-bold mb-6 tracking-tight">
        <span class="text-primary">Open-Core</span> Model
      </h2>
      <p class="text-text-muted text-lg mb-4">
        Core security substrate is free and open source.<br />
        Satellites add capability, not safety.
      </p>
      <p class="text-sm text-text-muted font-mono">
        Payment affects what you can add, not what you can see.
      </p>
    </div>

    <!-- Layer Cards -->
    <div class="grid lg:grid-cols-2 gap-8">
      {
        layers.map((layer) => (
          <div
            class={`relative flex flex-col bg-surface/50 border ${layer.border} border-dotted p-8 hover:bg-surface/80 transition-colors rounded-sm`}>
            <div class="absolute -top-3 left-4">
              <span
                class={`${layer.badgeColor} px-3 py-1 text-xs font-bold uppercase tracking-wider rounded-sm`}>
                {layer.badge}
              </span>
            </div>

            <div class="mb-6 pt-2">
              <h3 class="text-2xl font-bold text-white mb-1 font-mono">{layer.name}</h3>
              <p class="text-xl text-primary font-bold font-mono">{layer.access}</p>
              <p class="text-sm text-text-muted mt-2">{layer.description}</p>
            </div>

            <div class="mb-4">
              <p class="text-xs text-text-muted uppercase tracking-wider mb-2 font-mono">
                Packages
              </p>
              <div class="flex flex-wrap gap-2">
                {layer.packages.map((pkg) => (
                  <span class="px-2 py-1 bg-surface-highlight text-xs font-mono text-white rounded-sm">
                    {pkg}
                  </span>
                ))}
              </div>
            </div>

            <div class="space-y-3 flex-1 mb-6">
              <ul class="space-y-2">
                {layer.features.map((feature) => (
                  <li class="text-sm flex items-start gap-3 text-text-muted">
                    <Check className="h-4 w-4 text-primary shrink-0 mt-0.5" />
                    <span>{feature}</span>
                  </li>
                ))}
              </ul>
            </div>

            <div class="pt-4 border-t border-white/5 mb-6">
              <p class="text-xs text-text-muted italic">{layer.highlight}</p>
            </div>

            <div class="mt-auto">
              <a
                href={layer.ctaLink}
                class={`block w-full py-3 px-4 text-center text-sm font-bold uppercase tracking-wider rounded-sm transition-all ${
                  layer.name === 'Substrate'
                    ? 'bg-primary text-background hover:bg-primary/90'
                    : 'bg-surface-highlight text-white hover:bg-surface-highlight/80 border border-white/5'
                }`}>
                {layer.cta}
              </a>
            </div>
          </div>
        ))
      }
    </div>

    <!-- Philosophy Section -->
    <div class="mt-16 p-8 bg-surface/30 border border-primary/20 rounded-sm">
      <div class="max-w-3xl mx-auto text-center">
        <h3 class="text-xl font-bold text-white mb-4 font-mono">Open-Core Philosophy</h3>
        <div class="grid md:grid-cols-3 gap-6 text-left">
          <div>
            <p class="text-primary font-bold mb-2">No Hot-Path Licensing</p>
            <p class="text-sm text-text-muted">
              Core security paths never check payment state. No feature gates in intercept().
            </p>
          </div>
          <div>
            <p class="text-primary font-bold mb-2">No Degradation</p>
            <p class="text-sm text-text-muted">
              Substrate never reduces visibility or functionality based on licensing.
            </p>
          </div>
          <div>
            <p class="text-primary font-bold mb-2">Inspectability</p>
            <p class="text-sm text-text-muted">
              Open source ensures determinism is verifiable, not just claimed.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
